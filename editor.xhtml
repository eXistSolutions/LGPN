<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:TEI="http://www.tei-c.org/ns/1.0" xmlns:bfc="http://betterform.sourceforge.net/xforms/controls" xmlns:xf="http://www.w3.org/2002/xforms" data-template="templates:surround" data-template-with="templates/page.html" data-template-at="content">
    <head>
        <title>LGPN</title><!--
        ~ Copyright (c) 2015. existsolutions - http://www.exsitsolutions.com
        -->
        <link rel="stylesheet" type="text/css" href="$shared/resources/css/bootstrap-3.0.3.min.css"/>
        <link href="resources/js/vendor/select2/select2.css" rel="stylesheet"/>
        <link rel="stylesheet" type="text/css" href="resources/css/editor.css"/>
    </head>
    <body>
        <div style="display:none">
            <xf:model id="model-1">
                <xf:instance xmlns="" id="i-default" src="resources/xml/teiPersonTemplate.xml"/>
                <xf:bind nodeset="//TEI:nym/@nymRef" required="true()" type="xs:string"/>
                <xf:instance xmlns="" id="i-template" src="resources/xml/personTemplate.xml"/>
                <xf:instance xmlns="" id="i-volumes" src="resources/xml/volumes.xml"/>
                <xf:instance xmlns="" id="i-genders" src="resources/xml/genders.xml"/>
                <xf:instance xmlns="" id="i-personType" src="resources/xml/personType.xml"/>
                <xf:instance xmlns="" id="i-certainty" src="resources/xml/certainty.xml"/>
                <xf:instance xmlns="" id="i-personDating" src="resources/xml/personDating.xml"/>
                <xf:instance xmlns="" id="i-dating" src="resources/xml/dating.xml"/>
                <xf:instance xmlns="" id="i-period" src="resources/xml/datingPeriod.xml"/>
                <xf:instance xmlns="" id="i-sourceTypes" src="resources/xml/sourceTypes.xml"/>
                <xf:instance xmlns="" id="i-sourceSubTypes" src="resources/xml/sourceSubTypes.xml"/>
                <xf:instance xmlns="" id="i-sources" src="resources/xml/sources.xml"/>
                <xf:instance xmlns="" id="i-names" src="resources/xml/names.xml"/>
                <xf:instance xmlns="" id="i-origins" src="resources/xml/origins.xml"/>
                <xf:instance xmlns="" id="i-places" src="resources/xml/places.xml"/>
                <xf:instance xmlns="" id="i-locations" src="resources/xml/locations.xml"/>
                <xf:instance xmlns="" id="i-relationships" src="resources/xml/relationships.xml"/>
                <xf:instance xmlns="" id="i-relationships" src="resources/xml/relationships.xml"/>
                <xf:instance xmlns="" id="i-relationshipTypes" src="resources/xml/relationshipTypes.xml"/>
                <xf:instance xmlns="" id="i-comments" src="resources/xml/comments.xml"/>
                <xf:instance xmlns="" id="i-languages" src="resources/xml/languages.xml"/>
                <xf:instance xmlns="" id="i-secondaryTypes" src="resources/xml/secondaryTypes.xml"/>
                <xf:instance xmlns="" id="i-cases" src="resources/xml/cases.xml"/>
                <xf:instance xmlns="" id="i-linking" src="resources/xml/linking.xml"/>
                <xf:instance xmlns="" id="i-status" src="resources/xml/status.xml"/>
                <xf:instance xmlns="" id="i-office" src="resources/xml/office.xml"/>
                <xf:instance xmlns="" id="i-religion" src="resources/xml/religion.xml"/>
                <xf:instance xmlns="" id="i-profession" src="resources/xml/profession.xml"/>
                <xf:instance xmlns="" id="i-roman" src="resources/xml/roman.xml"/>
                <xf:instance xmlns="" id="i-other" src="resources/xml/other.xml"/>
                <xf:instance xmlns="" id="i-tribes" src="resources/xml/tribes.xml"/>
                <xf:instance xmlns="" id="i-filiation" src="resources/xml/filiation.xml"/>
                <xf:instance id="i-controller">
                    <data xmlns="">
                        <bibl/>
                        <place/>
                    </data>
                </xf:instance>
                <xf:submission id="s-load-data" method="get" replace="instance" ref="instance('i-default')" validate="false" resource="modules/load.xql?id={bf:appContext('id')}">
                    <xf:message ev:event="xforms-submit-done" level="ephemeral">Data have been
                  loaded.</xf:message>
                    <xf:message ev:event="xforms-submit-error">Failed to load data.</xf:message>
                </xf:submission>
                <xf:submission id="s-save-data" method="post" replace="none" validate="true" resource="modules/save.xql">
                    <xf:action ev:event="xforms-submit"><!--
<xf:setvalue ref="instance('i-default')//TEI:person/@xml:id" value="instance('i-default')//TEI:nym[@type='latin']"/>
-->
                        <xf:message ev:event="xforms-submit-done" level="ephemeral">Saving...</xf:message>
                    </xf:action>
                    <xf:message ev:event="xforms-submit-done" level="ephemeral">Data have been
                  saved.</xf:message>
                    <xf:message ev:event="xforms-submit-error">Failed to save data</xf:message>
                </xf:submission>
                <xf:action ev:event="xforms-ready">
                    <xf:send submission="s-load-data" if="bf:appContext('id') != ''"/>
                    <script>
                        clearAndInitAutocompletes();
                    </script>
                </xf:action>
            </xf:model>
            <xf:group id="load-subform-group">
                <xf:action ev:event="load-subform-event" if="string-length(instance('i-controller')/bibl) &gt; 0">
                    <xf:load show="embed" targetid="mountpoint">
                        <xf:resource value="concat('bibl.xhtml?bibl=', instance('i-controller')/bibl,'#xforms')"/>
                        <xf:extension includeCSS="false" includeScript="false"/>
                    </xf:load>
                    <bfc:show dialog="bibl"/>
                </xf:action>
                <xf:action ev:event="load-subform-event" if="string-length(instance('i-controller')/bibl) = 0">
                    <xf:load show="embed" targetid="mountpoint">
                        <xf:resource value="'bibl.xhtml#xforms'"/>
                        <xf:extension includeCSS="false" includeScript="false"/>
                    </xf:load>
                    <bfc:show dialog="bibl"/>
                </xf:action>
                <xf:action ev:event="load-place-subform-event" if="string-length(instance('i-controller')/place) &gt; 0">
                    <xf:load show="embed" targetid="mountpointPlace">
                        <xf:resource value="concat('place.xhtml?place=', instance('i-controller')/place,'#xforms')"/>
                        <xf:extension includeCSS="false" includeScript="false"/>
                    </xf:load>
                    <bfc:show dialog="place"/>
                </xf:action>
                <xf:action ev:event="load-place-subform-event" if="string-length(instance('i-controller')/place) = 0">
                    <xf:load show="embed" targetid="mountpointPlace">
                        <xf:resource value="'place.xhtml#xforms'"/>
                        <xf:extension includeCSS="false" includeScript="false"/>
                    </xf:load>
                    <bfc:show dialog="place"/>
                </xf:action>
            </xf:group>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-xs-8">
                    <h2>LGPN person input form</h2>
                </div>
            </div>
            <div class="row"/>
            <br/>
            <fieldset id="general">
                <legend> General </legend>
                <div class="row">
                    <div class="col-xs-3">
                        <div class="input-group input-group">
                            <xf:output class="input-group -form-control" ref="//TEI:person/@xml:id">
                                <xf:label class="input-group-addon glyphicon glyphicon-lock"/>
                                <xf:hint>id</xf:hint>
                            </xf:output>
                        </div>
                    </div>
                    <div class="col-xs-3">
                        <xf:select1 class="input-group -form-control" ref="//TEI:person/@sex">
                            <xf:label class="input-group-addon glyphicon glyphicon-user">gender</xf:label>
                            <xf:itemset nodeset="instance('i-genders')/option">
                                <xf:label ref="."/>
                                <xf:value ref="@value"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-3">
                        <xf:select1 class="input-group -form-control" ref="//TEI:person/@type">
                            <xf:label class="input-group-addon glyphicon glyphicon-user">type</xf:label>
                            <xf:itemset nodeset="instance('i-personType')/option">
                                <xf:label ref="."/>
                                <xf:value ref="@value"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-3">
                        <xf:select1 class="input-group -form-control" ref="//TEI:bibl[@type='volume']/TEI:ref/@target">
                            <xf:label class="input-group-addon glyphicon glyphicon-book">volume</xf:label>
                            <xf:itemset nodeset="instance('i-volumes')/option">
                                <xf:label ref="."/>
                                <xf:value ref="@value"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                </div>
                <br/>
                <div class="row">
                    <div class="col-xs-2">
                        <xf:select1 class="input-group -form-control" ref="//TEI:birth/@when">
                            <xf:label class="input-group-addon glyphicon glyphicon-calendar">period</xf:label>
                            <xf:itemset nodeset="instance('i-period')/TEI:category">
                                <xf:label ref="./TEI:catDesc/TEI:date"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-2">
                        <xf:input class="input-group -form-control" ref="//TEI:birth/@notBefore">
                            <xf:label class="input-group-addon glyphicon glyphicon-calendar"/>
                            <xf:hint>not before</xf:hint>
                        </xf:input>
                    </div>
                    <div class="col-xs-2">
                        <xf:input class="input-group -form-control" ref="//TEI:birth/@notAfter">
                            <xf:label class="input-group-addon glyphicon glyphicon-calendar"/>
                            <xf:hint>not after</xf:hint>
                        </xf:input>
                    </div>
                    <div class="col-xs-3">
                        <xf:select1 class="input-group -form-control" ref="//TEI:birth/@cert">
                            <xf:label class="input-group-addon glyphicon glyphicon-check"/>
                            <xf:itemset nodeset="instance('i-certainty')/option">
                                <xf:label ref="."/>
                                <xf:value ref="@value"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-4">
                        <div class="input-group">
                            <xf:select class="input-group -form-control" ref="//TEI:birth/@ana" appearance="full">
                                <xf:label class="input-group-addon glyphicon glyphicon-calendar"/>
                                <xf:itemset nodeset="instance('i-personDating')//option">
                                    <xf:label ref="."/>
                                    <xf:value ref="@value"/>
                                </xf:itemset>
                            </xf:select>
                        </div>
                    </div>
                </div>
            </fieldset>
            <xf:group ref="//TEI:person"><!-- NAMES -->
                <xf:group class="fieldset">
                    <xf:label>
                        <h3>Names</h3>
                    </xf:label>
                    <div class="row">
                        <div class="col-xs-12">
                            <xf:input class="input-group -form-control" ref="TEI:persName">
                                <xf:label class="input-group-addon glyphicon glyphicon-font">final bracket</xf:label>
                                <xf:hint>full attested form (aka final bracket)</xf:hint>
                            </xf:input>
                        </div>
                    </div>
                    <xf:repeat ref="TEI:listNym/TEI:nym[@type!='Roman']" id="r-name">
                        <xf:label>Name</xf:label>
                        <xf:group ref=".">
                            <xf:label/>
                            <div class="row">
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <label class="input-group-addon glyphicon glyphicon-book" tooltip="ref"/>
                                        <div>
                                            <xf:input class="-input-group --form-control" ref="@nymRef" style="display:none">
                                                <xf:action ev:event="nyms_autocomplete-callback">
                                                    <xf:setvalue ref="." value="event('termValue')"/>
                                                </xf:action>
                                                <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                                <xf:hint>normalized form</xf:hint>
                                            </xf:input>
                                            <input type="hidden" data-function="nyms_autocomplete" placeholder="Type to search ..." autocomplete="off"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="@type">
                                        <xf:label class="input-group-addon glyphicon glyphicon-list"/>
                                        <xf:itemset nodeset="instance('i-names')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="@ana">
                                        <xf:label class="input-group-addon glyphicon glyphicon-flag"/>
                                        <xf:itemset nodeset="instance('i-origins')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="TEI:seg[@type='linking']">
                                        <xf:label class="input-group-addon glyphicon glyphicon-link"/>
                                        <xf:itemset nodeset="instance('i-linking')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div><!--
                                <div class="col-xs-1">
                                    <xf:input class="input-group -form-control" ref="@n">
                                        <xf:label class="input-group-addon glyphicon glyphicon-font"/>
                                        <xf:hint>position</xf:hint>
                                    </xf:input>
                                </div>
                                -->
                                <div class="col-xs-1">
                                    <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                        <xf:label/>
                                        <xf:delete nodeset="//TEI:nym[index('r-name')]"/>
                                    </xf:trigger>
                                </div>
                            </div><!-- Attested forms -->
                            <xf:repeat ref="TEI:form[@type='attested']" id="r-nameForm">
                                <xf:label>Attested form</xf:label>
                                <xf:group ref=".">
                                    <xf:label/>
                                </xf:group>
                                <div class="row">
                                    <div class="col-xs-2">
                                        <xf:input class="input-group -form-control" ref="TEI:persName">
                                            <xf:label class="input-group-addon glyphicon glyphicon-font"/>
                                            <xf:hint>attested name</xf:hint>
                                        </xf:input>
                                    </div>
                                    <div class="col-xs-2">
                                        <xf:select1 class="input-group -form-control" ref="TEI:persName/@ana">
                                            <xf:label class="input-group-addon glyphicon glyphicon-pencil"/>
                                            <xf:itemset nodeset="instance('i-cases')/option">
                                                <xf:label ref="."/>
                                                <xf:value ref="@value"/>
                                            </xf:itemset>
                                        </xf:select1>
                                    </div>
                                    <div class="col-xs-2">
                                        <xf:select1 class="input-group -form-control" ref="TEI:persName/@xml:lang">
                                            <xf:label class="input-group-addon glyphicon glyphicon-globe"/>
                                            <xf:itemset nodeset="instance('i-languages')/option">
                                                <xf:label ref="."/>
                                                <xf:value ref="@value"/>
                                            </xf:itemset>
                                        </xf:select1>
                                    </div>
                                    <div class="col-xs-2">
                                        <xf:input class="input-group -form-control" ref="TEI:persName/@n">
                                            <xf:label class="input-group-addon glyphicon glyphicon-pencil"/>
                                            <xf:hint>line</xf:hint>
                                        </xf:input>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class="input-group">
                                            <xf:select class="input-group -form-control" ref="TEI:persName/@corresp" appearance="full">
                                                <xf:label class="input-group-addon">source</xf:label>
                                                <xf:itemset nodeset="instance('i-sources')//option">
                                                    <xf:label ref="."/>
                                                    <xf:value ref="@value"/>
                                                </xf:itemset>
                                            </xf:select>
                                        </div>
                                    </div>
                                    <div class="col-xs-1">
                                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                            <xf:label/>
                                            <xf:delete nodeset="//TEI:nym[@type!='Roman'][index('r-name')]/TEI:form[index('r-nameForm')]"/>
                                        </xf:trigger>
                                    </div>
                                </div>
                            </xf:repeat>
                            <div class="row">
                                <div class="col-xs-10"/>
                                <div class="col-xs-1">
                                    <xf:label>add attested form</xf:label>
                                </div>
                                <div class="col-xs-1">
                                    <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                        <xf:label/>
                                        <xf:insert context="//TEI:nym[@type!='Roman'][index('r-name')]" nodeset="TEI:form" origin="instance('i-template')//TEI:form[@type='attested']"/>
                                        <script>
                                    clearAndInitAutocompletes();
                                </script>
                                    </xf:trigger>
                                </div>
                            </div>
                        </xf:group>
                    </xf:repeat>
                    <div class="row">
                        <div class="col-xs-10"/>
                        <div class="col-xs-1">
                            <xf:label>add name</xf:label>
                        </div>
                        <div class="col-xs-1">
                            <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                <xf:label/>
                                <xf:insert context="//TEI:listNym" nodeset="TEI:nym" origin="instance('i-template')//TEI:nym[@type!='Roman']"/>
                                <script>
                                    clearAndInitAutocompletes();
                                </script>
                            </xf:trigger>
                        </div>
                    </div><!-- Roman names -->
                    <xf:repeat ref="TEI:listNym/TEI:nym[@type='Roman']" id="r-rname">
                        <xf:label>Roman name</xf:label>
                        <xf:group ref=".">
                            <xf:label/>
                            <div class="row">
                                <div class="col-xs-2">
                                    <div class="input-group">
                                        <label class="input-group-addon glyphicon glyphicon-book" tooltip="ref"/>
                                        <div>
                                            <xf:input class="-input-group --form-control" ref="TEI:persName[@type='praenomen']" style="display:none">
                                                <xf:action ev:event="nyms_autocomplete-callback">
                                                    <xf:setvalue ref="." value="event('termValue')"/>
                                                </xf:action>
                                                <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                                <xf:hint>praenomen</xf:hint>
                                            </xf:input>
                                            <input type="hidden" data-function="nyms_autocomplete" placeholder="praenomen" autocomplete="off"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-2">
                                    <div class="input-group">
                                        <label class="input-group-addon glyphicon glyphicon-book" tooltip="ref"/>
                                        <div>
                                            <xf:input class="-input-group --form-control" ref="TEI:persName[@type='nomen_gentile']" style="display:none">
                                                <xf:action ev:event="nyms_autocomplete-callback">
                                                    <xf:setvalue ref="." value="event('termValue')"/>
                                                </xf:action>
                                                <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                                <xf:hint>nomen gentile</xf:hint>
                                            </xf:input>
                                            <input type="hidden" data-function="nyms_autocomplete" placeholder="n. gentile" autocomplete="off"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="TEI:persName[@type='filiation']/@subtype">
                                        <xf:label class="input-group-addon glyphicon glyphicon-list"/>
                                        <xf:itemset nodeset="instance('i-filiation')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-2">
                                    <div class="input-group">
                                        <label class="input-group-addon glyphicon glyphicon-book" tooltip="ref"/>
                                        <div>
                                            <xf:input class="-input-group --form-control" ref="TEI:persName[@type='filiation']" style="display:none">
                                                <xf:action ev:event="nyms_autocomplete-callback">
                                                    <xf:setvalue ref="." value="event('termValue')"/>
                                                </xf:action>
                                                <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                                <xf:hint>filiation</xf:hint>
                                            </xf:input>
                                            <input type="hidden" data-function="nyms_autocomplete" placeholder="filiation" autocomplete="off"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="TEI:persName[@type='tribe']">
                                        <xf:label class="input-group-addon glyphicon glyphicon-list"/>
                                        <xf:itemset nodeset="instance('i-tribes')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-1">
                                    <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                        <xf:label/>
                                        <xf:delete nodeset="//TEI:nym[index('r-rname')]"/>
                                    </xf:trigger>
                                </div>
                            </div><!--
                            <xf:repeat ref="TEI:form[@type='attested']" id="r-nameForm">
                                <xf:label/>
                                <xf:group ref=".">
                                    <xf:label/>
                                </xf:group>
                                <div class="row">
                                    <div class="col-xs-2">
                                        <xf:input class="input-group -form-control" ref="TEI:persName">
                                            <xf:label class="input-group-addon glyphicon glyphicon-font"/>
                                            <xf:hint>attested name</xf:hint>
                                        </xf:input>
                                    </div>
                                    <div class="col-xs-1">
                                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                            <xf:label/>
                                            <xf:delete nodeset="//TEI:state[index('r-place')]"/>
                                        </xf:trigger>
                                    </div>
                                </div>
                            </xf:repeat>
                            -->
                        </xf:group>
                    </xf:repeat>
                    <div class="row">
                        <div class="col-xs-10"/>
                        <div class="col-xs-1">
                            <xf:label>add Roman name</xf:label>
                        </div>
                        <div class="col-xs-1">
                            <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                <xf:label/>
                                <xf:insert context="//TEI:listNym" nodeset="TEI:nym" origin="instance('i-template')//TEI:nym[@type='Roman']"/>
                                <script>
                                    clearAndInitAutocompletes();
                                </script>
                            </xf:trigger>
                        </div>
                    </div>
                </xf:group>
                <xf:group class="fieldset">
                    <xf:label>
                        <h3>Primary sources</h3>
                    </xf:label>
                    <xf:repeat ref="TEI:bibl[@type='primary']" id="r-primarySource">
                        <xf:label/>
                        <xf:group ref=".">
                            <xf:label/>
                            <div class="row">
                                <div class="col-xs-2">
                                    <div class="input-group">
                                        <label class="input-group-addon glyphicon glyphicon-book" tooltip="ref"/>
                                        <div>
                                            <xf:input class="-input-group --form-control" ref="TEI:ref/@target" style="display:none">
                                                <xf:action ev:event="reference_autocomplete-callback">
                                                    <xf:setvalue ref="." value="event('termValue')"/>
                                                </xf:action>
                                                <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                                <xf:hint>reference abbreviation</xf:hint>
                                            </xf:input>
                                            <input type="hidden" data-function="reference_autocomplete" placeholder="Type to search ..." autocomplete="off"/>
                                        </div>
                                    </div>
                                    <xf:trigger class="hidden reference_autocomplete">
                                        <xf:label/>
                                        <xf:action ev:event="DOMActivate">
                                            <xf:setvalue ref="instance('i-controller')/bibl" value="instance('i-default')//TEI:bibl[index('r-primarySource')]/TEI:ref/@target"/>
                                            <xf:dispatch name="load-subform-event" targetid="load-subform-group"/>
                                        </xf:action>
                                    </xf:trigger>
                                </div>
                                <div class="col-xs-2">
                                    <xf:input class="input-group -form-control" ref="TEI:ref">
                                        <xf:label class="input-group-addon glyphicon glyphicon-list"/>
                                        <xf:hint>reference details</xf:hint>
                                    </xf:input>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="TEI:ref/@type">
                                        <xf:label class="input-group-addon glyphicon glyphicon-tag"/>
                                        <xf:itemset nodeset="instance('i-sourceTypes')/TEI:category">
                                            <xf:label ref="TEI:catDesc"/>
                                            <xf:value ref="@xml:id"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="TEI:ref/@subtype">
                                        <xf:label class="input-group-addon glyphicon glyphicon-tags"/>
                                        <xf:itemset nodeset="instance('i-sourceTypes')/TEI:category/TEI:category">
                                            <xf:label ref="TEI:catDesc"/>
                                            <xf:value ref="@xml:id"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="TEI:ref/TEI:seg/@type">
                                        <xf:label class="input-group-addon glyphicon glyphicon-tags"/>
                                        <xf:itemset nodeset="instance('i-other')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-2">
                                    <xf:input class="input-group -form-control" ref="TEI:ref/TEI:seg">
                                        <xf:label class="input-group-addon glyphicon glyphicon-edit"/>
                                        <xf:hint>reading</xf:hint>
                                    </xf:input>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-xs-4">
                                    <xf:input class="input-group -form-control" ref="TEI:date/@notBefore">
                                        <xf:label class="input-group-addon glyphicon glyphicon-calendar"/>
                                        <xf:hint>not before</xf:hint>
                                    </xf:input>
                                </div>
                                <div class="col-xs-4">
                                    <xf:input class="input-group -form-control" ref="TEI:date/@notAfter">
                                        <xf:label class="input-group-addon glyphicon glyphicon-calendar"/>
                                        <xf:hint>not after</xf:hint>
                                    </xf:input>
                                </div>
                                <div class="col-xs-4">
                                    <xf:select1 class="input-group -form-control" ref="TEI:date/@cert">
                                        <xf:label class="input-group-addon glyphicon glyphicon-check"/>
                                        <xf:itemset nodeset="instance('i-certainty')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-11">
                                    <div class="input-group">
                                        <xf:select class="input-group -form-control" ref="TEI:date/@ana" appearance="full">
                                            <xf:label class="input-group-addon">dating</xf:label>
                                            <xf:itemset nodeset="instance('i-dating')//option">
                                                <xf:label ref="."/>
                                                <xf:value ref="@value"/>
                                            </xf:itemset>
                                        </xf:select>
                                    </div>
                                </div>
                                <div class="col-xs-1">
                                    <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                        <xf:label/>
                                        <xf:delete nodeset="//TEI:bibl[@type='primary'][index('r-primarySource')]"/>
                                    </xf:trigger>
                                </div>
                            </div>
                        </xf:group>
                    </xf:repeat>
                    <div class="row">
                        <div class="col-xs-11"/>
                        <div class="col-xs-1">
                            <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                <xf:label/>
                                <xf:insert context="//TEI:person" nodeset="TEI:bibl" origin="instance('i-template')//TEI:bibl[@type='primary']"/>
                            </xf:trigger>
                        </div>
                    </div>
                </xf:group><!-- PLACES -->
                <xf:group class="fieldset">
                    <xf:label>
                        <h3>Places</h3>
                    </xf:label>
                    <xf:repeat ref="TEI:state[@type='location']" id="r-place">
                        <xf:label/>
                        <xf:group ref=".">
                            <xf:label/>
                            <div class="row">
                                <div class="col-xs-3">
                                    <xf:select1 class="input-group -form-control" ref="@subtype">
                                        <xf:label class="input-group-addon glyphicon glyphicon-tag"/>
                                        <xf:itemset nodeset="instance('i-places')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <label class="input-group-addon glyphicon glyphicon-map-marker" tooltip="ref"/>
                                        <div>
                                            <xf:input class="-input-group --form-control" ref="TEI:placeName/@key" style="display:none">
                                                <xf:action ev:event="places_autocomplete-callback">
                                                    <xf:setvalue ref="." value="event('termValue')"/>
                                                </xf:action>
                                                <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                                <xf:hint>place</xf:hint>
                                            </xf:input>
                                            <input type="hidden" data-function="places_autocomplete" placeholder="Type to search ..." autocomplete="off"/>
                                            <xf:trigger class="hidden places_autocomplete">
                                                <xf:label/>
                                                <xf:action ev:event="DOMActivate">
                                                    <xf:setvalue ref="instance('i-controller')/place" value="instance('i-default')//TEI:state[@type='location'][index('r-place')]/TEI:placeName/@key"/>
                                                    <xf:dispatch name="load-place-subform-event" targetid="load-subform-group"/>
                                                </xf:action>
                                            </xf:trigger>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="TEI:placeName/@subtype">
                                        <xf:label class="input-group-addon glyphicon glyphicon-pencil"/>
                                        <xf:itemset nodeset="instance('i-locations')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-3">
                                    <xf:select1 class="input-group -form-control" ref="TEI:placeName/@cert">
                                        <xf:label class="input-group-addon glyphicon glyphicon-check"/>
                                        <xf:itemset nodeset="instance('i-certainty')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-11">
                                    <div class="input-group">
                                        <xf:select class="input-group -form-control" ref="TEI:placeName/@corresp" appearance="full">
                                            <xf:label class="input-group-addon">source</xf:label>
                                            <xf:itemset nodeset="instance('i-sources')//option">
                                                <xf:label ref="."/>
                                                <xf:value ref="@value"/>
                                            </xf:itemset>
                                        </xf:select>
                                    </div>
                                </div>
                                <div class="col-xs-1">
                                    <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                        <xf:label/>
                                        <xf:delete nodeset="//TEI:state[index('r-place')]"/>
                                    </xf:trigger>
                                </div>
                            </div>
                        </xf:group>
                    </xf:repeat>
                    <div class="row">
                        <div class="col-xs-11"/>
                        <div class="col-xs-1">
                            <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                <xf:label/>
                                <xf:insert context="//TEI:person" nodeset="TEI:state" origin="instance('i-template')//TEI:state[@type='location']"/>
                            </xf:trigger>
                        </div>
                    </div>
                </xf:group>
                <legend> Status </legend>
                <xf:repeat ref="//TEI:trait[@type='status']" id="r-status">
                    <xf:label/>
                    <xf:group ref=".">
                        <div class="row">
                            <div class="col-xs-4">
                                <xf:select1 class="input-group -form-control" ref="@key">
                                    <xf:label class="input-group-addon glyphicon glyphicon-tag">status</xf:label>
                                    <xf:itemset nodeset="instance('i-status')/TEI:category">
                                        <xf:label ref="TEI:catDesc"/>
                                        <xf:value ref="@xml:id"/>
                                    </xf:itemset>
                                </xf:select1>
                            </div>
                            <div class="col-xs-4">
                                <xf:select1 class="input-group -form-control" ref="@ana">
                                    <xf:label class="input-group-addon glyphicon glyphicon-tags"/>
                                    <xf:itemset nodeset="instance('i-status')/TEI:category/TEI:category">
                                        <xf:label ref="TEI:catDesc"/>
                                        <xf:value ref="@xml:id"/>
                                    </xf:itemset>
                                </xf:select1>
                            </div>
                            <div class="col-xs-1">
                                <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                    <xf:label/>
                                    <xf:delete nodeset="//TEI:trait[@type='status'][index('r-status')]"/>
                                </xf:trigger>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-11"/>
                            <div class="col-xs-1">
                                <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                    <xf:label/>
                                    <xf:insert context="//TEI:person" nodeset="TEI:trait" origin="instance('i-template')//TEI:trait[@type='status']"/>
                                </xf:trigger>
                            </div>
                        </div>
            </xf:group>
        </xf:repeat>
        <xf:repeat ref="//TEI:trait[@type='profession']" id="r-profession">
            <xf:label/>
            <xf:group ref=".">
                <div class="row">
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@key">
                            <xf:label class="input-group-addon glyphicon glyphicon-tag">profession</xf:label>
                            <xf:itemset nodeset="instance('i-profession')/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@ana">
                            <xf:label class="input-group-addon glyphicon glyphicon-tags"/>
                            <xf:itemset nodeset="instance('i-profession')/TEI:category/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                            <xf:label/>
                            <xf:delete nodeset="//TEI:trait[@type='profession'][index('r-profession')]"/>
                        </xf:trigger>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-11"/>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                            <xf:label/>
                            <xf:insert context="//TEI:person" nodeset="TEI:trait" origin="instance('i-template')//TEI:trait[@type='profession']"/>
                        </xf:trigger>
                    </div>
                </div>
            </xf:group>
        </xf:repeat>
    
        <xf:repeat ref="//TEI:trait[@type='office']" id="r-office">
            <xf:label/>
            <xf:group ref=".">
                <div class="row">
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@key">
                            <xf:label class="input-group-addon glyphicon glyphicon-tag">office</xf:label>
                            <xf:itemset nodeset="instance('i-office')/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@ana">
                            <xf:label class="input-group-addon glyphicon glyphicon-tags"/>
                            <xf:itemset nodeset="instance('i-office')/TEI:category/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                            <xf:label/>
                            <xf:delete nodeset="//TEI:trait[@type='office'][index('r-office')]"/>
                        </xf:trigger>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-11"/>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                            <xf:label/>
                            <xf:insert context="//TEI:person" nodeset="TEI:trait" origin="instance('i-template')//TEI:trait[@type='office']"/>
                        </xf:trigger>
                    </div>
                </div>
            </xf:group>
        </xf:repeat>
        
        <xf:repeat ref="//TEI:trait[@type='religion']" id="r-religion">
            <xf:label/>
            <xf:group ref=".">
                <div class="row">
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@key">
                            <xf:label class="input-group-addon glyphicon glyphicon-tag">religion</xf:label>
                            <xf:itemset nodeset="instance('i-religion')/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@ana">
                            <xf:label class="input-group-addon glyphicon glyphicon-tags"/>
                            <xf:itemset nodeset="instance('i-religion')/TEI:category/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                            <xf:label/>
                            <xf:delete nodeset="//TEI:trait[@type='religion'][index('r-religion')]"/>
                        </xf:trigger>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-11"/>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                            <xf:label/>
                            <xf:insert context="//TEI:person" nodeset="TEI:trait" origin="instance('i-template')//TEI:trait[@type='religion']"/>
                        </xf:trigger>
                    </div>
                </div>
            </xf:group>
        </xf:repeat>
        
        <xf:repeat ref="//TEI:trait[@type='Roman']" id="r-Roman">
            <xf:label/>
            <xf:group ref=".">
                <div class="row">
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@key">
                            <xf:label class="input-group-addon glyphicon glyphicon-tag">Roman
                        world</xf:label>
                            <xf:itemset nodeset="instance('i-roman')/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-4">
                        <xf:select1 class="input-group -form-control" ref="@ana">
                            <xf:label class="input-group-addon glyphicon glyphicon-tags"/>
                            <xf:itemset nodeset="instance('i-roman')/TEI:category/TEI:category">
                                <xf:label ref="TEI:catDesc"/>
                                <xf:value ref="@xml:id"/>
                            </xf:itemset>
                        </xf:select1>
                    </div>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                            <xf:label/>
                            <xf:delete nodeset="//TEI:trait[@type='Roman'][index('r-Roman')]"/>
                        </xf:trigger>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-11"/>
                    <div class="col-xs-1">
                        <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                            <xf:label/>
                            <xf:insert context="//TEI:person" nodeset="TEI:trait" origin="instance('i-template')//TEI:trait[@type='Roman']"/>
                        </xf:trigger>
                    </div>
                </div>
            </xf:group>
        </xf:repeat>

                <!-- SECONDARY SOURCES -->
                <xf:group class="fieldset">
                    <xf:label>
                        <h3>Secondary sources</h3>
                    </xf:label>
                    <xf:repeat ref="TEI:bibl[@type = 'auxiliary']" id="r-auxiliary">
                        <xf:label/>
                        <div class="row">
                            <div class="col-xs-3">
                                <div class="input-group">
                                    <label class="input-group-addon glyphicon glyphicon-book" tooltip="ref"/>
                                    <div>
                                        <xf:input class="-input-group --form-control" ref="TEI:ref/@target" style="display:none">
                                            <xf:action ev:event="reference_autocomplete-callback">
                                                <xf:setvalue ref="." value="event('termValue')"/>
                                            </xf:action>
                                            <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                            <xf:hint>reference abbreviation</xf:hint>
                                        </xf:input>
                                        <input type="hidden" data-function="reference_autocomplete" placeholder="Type to search ..." autocomplete="off"/>
                                    </div>
                                </div>
                                <xf:trigger class="hidden reference_autocomplete">
                                    <xf:label/>
                                    <xf:action ev:event="DOMActivate">
                                        <xf:setvalue ref="instance('i-controller')/bibl" value="instance('i-default')//TEI:bibl[index('r-primarySource')]/TEI:ref/@target"/>
                                        <xf:dispatch name="load-subform-event" targetid="load-subform-group"/>
                                    </xf:action>
                                </xf:trigger>
                            </div>
                            <div class="col-xs-3">
                                <xf:input class="input-group -form-control" ref="TEI:author">
                                    <xf:label class="input-group-addon">author</xf:label>
                                </xf:input>
                            </div>
                            <div class="col-xs-2">
                                <xf:input class="input-group -form-control" ref="TEI:seg[@type='details']">
                                    <xf:label class="input-group-addon">details</xf:label>
                                </xf:input>
                            </div>
                            <div class="col-xs-3">
                                <xf:input class="input-group -form-control" ref="TEI:ptr/@ref">
                                    <xf:label class="input-group-addon glyphicon glyphicon-link">link</xf:label>
                                </xf:input>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-3">
                                <xf:select1 class="input-group -form-control" ref="@subtype">
                                    <xf:label class="input-group-addon glyphicon glyphicon-book"/>
                                    <xf:itemset nodeset="instance('i-secondaryTypes')/option">
                                        <xf:label ref="."/>
                                        <xf:value ref="@value"/>
                                    </xf:itemset>
                                </xf:select1>
                            </div>
                            <div class="col-xs-8">
                                <div class="input-group">
                                    <xf:select class="input-group -form-control" ref="@ana" appearance="full">
                                        <xf:label class="input-group-addon">source</xf:label>
                                        <xf:itemset nodeset="instance('i-comments')//option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select>
                                </div>
                            </div>
                            <div class="col-xs-1">
                                <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                    <xf:label/>
                                    <xf:delete nodeset="//TEI:bibl[@type = 'auxiliary'][index('r-auxiliary')]"/>
                                </xf:trigger>
                            </div>
                        </div>
                    </xf:repeat>
                    <div class="row">
                        <div class="col-xs-11"/>
                        <div class="col-xs-1">
                            <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                <xf:label/>
                                <xf:insert context="//TEI:person" nodeset="TEI:bibl" origin="instance('i-template')//TEI:bibl[@type = 'auxiliary']"/>
                                
                            </xf:trigger>
                        </div>
                    </div>
                </xf:group>
            </xf:group>
            <xf:group ref="//TEI:listRelation"><!-- RELATIONSHIPS -->
                <xf:group class="fieldset">
                    <xf:label>
                        <h3>Relationships</h3>
                    </xf:label>
                    <xf:repeat ref="TEI:relation" id="r-relation">
                        <xf:label/>
                        <xf:group ref=".">
                            <xf:label/>
                            <div class="row">
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="@name">
                                        <xf:label class="input-group-addon glyphicon glyphicon-tag"/>
                                        <xf:itemset nodeset="instance('i-relationships')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-2">
                                    <xf:select1 class="input-group -form-control" ref="@subtype">
                                        <xf:label class="input-group-addon glyphicon glyphicon-tag"/>
                                        <xf:itemset nodeset="instance('i-relationshipTypes')/option">
                                            <xf:label ref="."/>
                                            <xf:value ref="@value"/>
                                        </xf:itemset>
                                    </xf:select1>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group">
                                        <label class="input-group-addon glyphicon glyphicon-book" tooltip="ref"/>
                                        <div>
                                            <xf:input class="-input-group --form-control" ref="@passive" style="display:none">
                                                <xf:action ev:event="relatives_autocomplete-callback">
                                                    <xf:setvalue ref="." value="event('termValue')"/>
                                                </xf:action>
                                                <xf:label class="input-group-addon -glyphicon -glyphicon-book">ref</xf:label>
                                                <xf:hint>relative</xf:hint>
                                            </xf:input>
                                            <input type="hidden" data-function="relatives_autocomplete" placeholder="Type to search ..." autocomplete="off"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-2">
                                    <xf:input class="-input-group --form-control" ref=".">
                                        <xf:label class="input-group-addon glyphicon glyphicon-book"/>
                                        <xf:hint>person</xf:hint>
                                    </xf:input>
                                </div>
                                <div class="col-xs-1">
                                    <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                        <xf:label/>
                                        <xf:delete nodeset="//TEI:relation[index('r-relation')]"/>
                                    </xf:trigger>
                                </div>
                            </div>
                        </xf:group>
                    </xf:repeat>
                    <div class="row">
                        <div class="col-xs-11"/>
                        <div class="col-xs-1">
                            <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                <xf:label/>
                                <xf:insert context="//TEI:listRelation" nodeset="TEI:relation" origin="instance('i-template')//TEI:relation"/>
                            </xf:trigger>
                        </div>
                    </div>
                </xf:group>
            </xf:group>
            <br/>
            <xf:submit class="-btn -btn-success -glyphicon -glyphicon-save" submission="s-save-data">
                <xf:label>Save</xf:label>
            </xf:submit>
            <a href="browse.html" class="btn btn-default glyphicon glyphicon-out">Return to the list of names without saving</a>
        </div>
        <bfc:dialog id="bibl" src="bibl.html">
            <xf:label>Add bibl</xf:label>
            <div id="mountpoint"/>
        </bfc:dialog>
        <bfc:dialog id="place" src="place.html">
            <xf:label>Add place</xf:label>
            <div id="mountpointPlace"/>
        </bfc:dialog>
        <script type="text/javascript" src="$shared/resources/scripts/jquery/jquery-1.7.1.min.js"/>
        <script type="text/javascript" src="$shared/resources/scripts/loadsource.js"/>
        <script type="text/javascript" src="$shared/resources/scripts/bootstrap-3.0.3.min.js"/>
        <script src="$shared/resources/scripts/jquery/jquery-ui.min.js" type="text/javascript" charset="utf-8"/>
        <script type="text/javascript" src="resources/js/editor.js"/>
        <script type="text/javascript" src="resources/js/vendor/select2/select2.js"/>
        <script type="text/javascript" src="resources/js/select2/select2.js"/>
    </body>
</html>