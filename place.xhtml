<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:TEI="http://www.tei-c.org/ns/1.0" xmlns:bfc="http://betterform.sourceforge.net/xforms/controls" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <title>LGPN</title><!--
        ~ Copyright (c) 2015. existsolutions - http://www.exsitsolutions.com
        -->
        <link rel="stylesheet" type="text/css" href="$shared/resources/css/bootstrap-3.0.3.min.css"/>
        <link href="resources/js/vendor/select2/select2.css" rel="stylesheet"/>
        <link rel="stylesheet" type="text/css" href="resources/css/editor.css"/>
    </head>
    <body>
        <div id="xforms">
            <div style="display:none">
                <xf:model id="model-place">
                    <xf:instance id="i-place-default">
                        <wrapper xmlns="http://www.tei-c.org/ns/1.0">
                            <place type="settlement" xml:id="uuid" ref="LGPN_Syria">
                                <placeName type="" subtype="" cert="" xml:lang=""/>
                                <location type="pleiades">
                                    <label/>
                                </location>
                                <location cert="">
                                    <geo/>
                                    <alt/>
                                </location>
                            </place>
                        </wrapper>
                    </xf:instance>
                    <xf:instance id="i-place-template">
                        <wrapper xmlns="http://www.tei-c.org/ns/1.0">
                            <place type="settlement" xml:id="uuid" ref="LGPN_Syria">
                                <placeName type="" subtype="" cert="" xml:lang=""/>
                                <location type="pleiades">
                                    <label/>
                                </location>
                                <location cert="">
                                    <geo/>
                                    <alt/>
                                </location>
                            </place>
                        </wrapper>
                    </xf:instance>
                    <xf:instance xmlns="" id="i-certainty" src="resources/xml/certainty.xml"/>
                    <xf:instance xmlns="" id="i-variants" src="resources/xml/variants.xml"/>
                    <xf:instance xmlns="" id="i-languages" src="resources/xml/languages.xml"/>
                    <xf:instance xmlns="" id="i-periods" src="resources/xml/periods.xml"/>
                    <xf:instance xmlns="" id="i-placeTypes" src="resources/xml/placeTypes.xml"/>

                    <xf:submission id="s-load-place" method="get" replace="instance" ref="instance('i-place-default')" validate="false" resource="modules/loadPlace.xql?id={substring-before(bf:appContext('place'), '#xforms')}">
                        <xf:message ev:event="xforms-submit-done" level="ephemeral">Data have been loaded.</xf:message>
                        <xf:message ev:event="xforms-submit-error">Failed to load place data. <xf:output value="substring-before(bf:appContext('place'), '#xforms')"/>
                        </xf:message>
                    </xf:submission>
                    <xf:submission id="s-save-place" method="post" replace="none" ref="instance('i-place-default')" resource="modules/savePlace.xql">
                        <xf:action ev:event="xforms-submit">
                            <xf:message ev:event="xforms-submit-done" level="ephemeral">Saving...</xf:message>
                        </xf:action>
                        <xf:message ev:event="xforms-submit-done" level="ephemeral">Data have been saved.</xf:message>
                        <xf:message ev:event="xforms-submit-error">Failed to save place data</xf:message>
                    </xf:submission>
                    <xf:action ev:event="xforms-ready">
                        <xf:send submission="s-load-place"/>
                        <script>
                            clearAndInitAutocompletes();
                        </script>
                    </xf:action>
                </xf:model>
            </div>
            <div>
                <fieldset id="segment">
                    <legend>
                        LGPN place sub-form
                    </legend>
            <xf:group ref="//TEI:place">
                    <div class="row">
                        <div class="col-xs-3">
                            <xf:input class="input-group -form-control" ref="@xml:id">
                                <xf:label class="input-group-addon">id</xf:label>
                                <xf:hint>id</xf:hint>
                            </xf:input>
                        </div>
                        <div class="col-xs-4">
                            <xf:select1 class="input-group -form-control" ref="@type">
                                <xf:label class="input-group-addon glyphicon glyphicon-flag"/>
                                <xf:itemset nodeset="instance('i-placeTypes')/option">
                                    <xf:label ref="."/>
                                    <xf:value ref="@value"/>
                                </xf:itemset>
                            </xf:select1>
                        </div>
                        <div class="col-xs-3">
                            <div class="input-group">
                                <label class="input-group-addon glyphicon glyphicon-map-marker" tooltip="ref">in</label>
                                <div>
                                    <xf:input class="-input-group --form-control" ref="@ref" style="display:none">
                                        <xf:action ev:event="places_autocomplete-callback">
                                            <xf:setvalue ref="." value="event('termValue')"/>
                                        </xf:action>
                                        <xf:hint>place</xf:hint>
                                    </xf:input>
                                    <input type="hidden" data-function="places_autocomplete" placeholder="Type to search ..." autocomplete="off"/><!--
                                            <xf:trigger class="hidden places_autocomplete">
                                                <xf:label/>
                                                <xf:action ev:event="DOMActivate">
                                                    <xf:setvalue ref="instance('i-controller')/place" value="instance('i-default')//TEI:state[@type='location'][index('r-place')]/TEI:placeName/@key"/>
                                                    <xf:dispatch name="load-place-subform-event" targetid="load-subform-group"/>
                                                </xf:action>
                                            </xf:trigger>
                                            -->
                                </div>
                            </div>
                        </div>
                    </div>

                <fieldset id="segment">
                    <legend>
                        Name variants
                    </legend>

            <xf:repeat ref="//TEI:placeName" id="r-name">
                <xf:group ref=".">

                    <div class="row">
                        <div class="col-xs-3">
                            <xf:input class="input-group -form-control" ref=".">
                                <xf:label class="input-group-addon">name</xf:label>
                                <xf:hint>variant name</xf:hint>
                            </xf:input>
                        </div>
                        <div class="col-xs-2">
                            <xf:select1 class="input-group -form-control" ref="@type">
                                <xf:label class="input-group-addon glyphicon glyphicon-calendar"/>
                                <xf:itemset nodeset="instance('i-periods')/option">
                                    <xf:label ref="."/>
                                    <xf:value ref="@value"/>
                                </xf:itemset>
                            </xf:select1>
                        </div>
                    
                        <div class="col-xs-3">
                            <xf:select1 class="input-group -form-control" ref="@subtype">
                                <xf:label class="input-group-addon glyphicon glyphicon-signal"/>
                                <xf:itemset nodeset="instance('i-variants')/option">
                                    <xf:label ref="."/>
                                    <xf:value ref="@value"/>
                                </xf:itemset>
                            </xf:select1>
                        </div>
                        <div class="col-xs-2">
                            <xf:select1 class="input-group -form-control" ref="@xml:lang">
                                <xf:label class="input-group-addon glyphicon glyphicon-flag"/>
                                <xf:itemset nodeset="instance('i-languages')/option">
                                    <xf:label ref="."/>
                                    <xf:value ref="@value"/>
                                </xf:itemset>
                            </xf:select1>
                        </div>
                        <div class="col-xs-2">
                            <xf:select1 class="input-group -form-control" ref="@cert">
                                <xf:label class="input-group-addon glyphicon glyphicon-question-sign"/>
                                <xf:itemset nodeset="instance('i-certainty')/option">
                                    <xf:label ref="."/>
                                    <xf:value ref="@value"/>
                                </xf:itemset>
                            </xf:select1>
                        </div>
                        <div class="col-xs-1">
                            <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-trash">
                                <xf:label/>
                                <xf:delete nodeset="//TEI:placeName[index('r-name')]"/>
                            </xf:trigger>
                        </div>
                    </div>

                </xf:group>
            </xf:repeat>
                    <div class="row">
                        <div class="col-xs-1">
                            <xf:label>add variant name</xf:label>
                        </div>
                        <div class="col-xs-1">
                                <xf:trigger class="-btn -btn-default -glyphicon -glyphicon-plus">
                                        <xf:label/>
                                        <xf:insert context="." ref="TEI:placeName" origin="instance('i-place-template')//TEI:placeName"/>
                                </xf:trigger>
                        </div>
                    </div>
        </fieldset>
        
                    <div class="row">
                        <div class="col-xs-8">
                            <xf:input class="input-group  input-group-lg -form-control" ref="//TEI:geo">
                                <xf:label class="input-group-addon">geocoordinates</xf:label>
                                <xf:hint>lat lon</xf:hint>
                            </xf:input>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-8">
                            <xf:input class="input-group  input-group-lg -form-control" ref="//TEI:location[@type='pleiades']/TEI:label">
                                <xf:label class="input-group-addon">pleiades</xf:label>
                                <xf:hint>pleiades id</xf:hint>
                            </xf:input>
                        </div>
                    </div>
                    </xf:group>
                    <div class="row">
                        <div class="form-group">
                            <div class="col-sm-offset-4">
                                <xf:submit class="-btn -btn-primary -glyphicon -glyphicon-save" submission="s-save-place">
                                    <xf:label>Save</xf:label>
                                </xf:submit>
                                <xf:trigger class="-bigbtn -btn-primary -glyphicon -glyphicon-trash">
                                    <xf:label>Cancel</xf:label>
                                    <script ev:event="DOMActivate" type="text/javascript">dijit.byId("place").hide()</script>
                                </xf:trigger>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <script type="text/javascript" src="$shared/resources/scripts/jquery/jquery-1.7.1.min.js"/>
        <script type="text/javascript" src="$shared/resources/scripts/loadsource.js"/>
        <script type="text/javascript" src="$shared/resources/scripts/bootstrap-3.0.3.min.js"/>
        <script src="$shared/resources/scripts/jquery/jquery-ui.min.js" type="text/javascript" charset="utf-8"/>
        <script type="text/javascript" src="resources/js/editor.js"/>
        <script type="text/javascript" src="resources/js/vendor/select2/select2.js"/>
        <script type="text/javascript" src="resources/js/select2/select2.js"/>
    </body>
</html>